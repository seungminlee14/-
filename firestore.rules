rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // 커뮤니티 글
    match /posts/{postId} {
      allow read: if true; // 모두 조회 가능
      allow create: if request.auth != null; // 로그인 후 작성
      allow update, delete: if request.auth != null && request.auth.uid == resource.data.authorId; // 작성자만 수정/삭제

      // 댓글
      match /comments/{commentId} {
        allow read: if true;
        allow create: if request.auth != null;
      }

      // 좋아요/싫어요(사용자별 1개 문서)
      match /votes/{userId} {
        allow read, write: if request.auth != null && request.auth.uid == userId;
      }
    }

    // 글 번호 카운터 등 메타데이터
    match /meta/{docId} {
      allow read, write: if request.auth != null;
    }

    // 계정 정지
    match /bans/{email} {
      allow read: if request.auth != null;
      allow write: if request.auth != null; // 콘솔에서 관리자만 쓰도록 제어하세요.
    }

    // 정지/해제 기록
    match /banLogs/{logId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null; // 콘솔에서 관리자만 쓰도록 제어하세요.
    }

    // 공지/알림
    match /notifications/{notificationId} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.token.email != null &&
        request.auth.token.email == 'seungminlee14@naver.com';
    }
  }
}
